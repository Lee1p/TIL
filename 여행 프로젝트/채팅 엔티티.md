## ğŸ“Œ ìŠ¤í”„ë§ë¶€íŠ¸ ì±„íŒ…ë°© ëª©ë¡ ì¡°íšŒ êµ¬í˜„ ì •ë¦¬ (JPA + MVC + Thymeleaf)

### íë¦„ 
Entity ìƒì„± ->  Repository ìƒì„± -> DTO ìƒì„± -> Service ìƒì„± -> Controller ìƒì„± -> View / API ì—°ë™

â¬‡ï¸ ì±„íŒ…ë°© ERD

![image](https://github.com/user-attachments/assets/75805f92-b269-43da-8e8f-31aab5b63741)


ì±„íŒ…ë°© Entity

```java
package com.test.foodtrip.domain.chat.entity;


import lombok.AccessLevel;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Getter;
import lombok.NoArgsConstructor;
import jakarta.persistence.*;
import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;

@Entity
@Table(name = "chatroom")
@Getter 
@NoArgsConstructor(access = AccessLevel.PROTECTED) // JPA ë‚´ë¶€ìš© ê¸°ë³¸ ìƒì„±ì
@AllArgsConstructor
@Builder
public class ChatRoom {

    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "chat_room_seq")
    @SequenceGenerator(name = "chat_room_seq", sequenceName = "chat_room_seq", allocationSize = 1)
    @Column(name = "chatroom_id")
    private Long id;

    @Column(name = "title", length = 100, nullable = false)
    private String title;

    @Column(name = "thumbnail_image_url", length = 255)
    private String thumbnailImageUrl;

    @Builder.Default
    @Column(name = "is_deleted", length = 1, nullable = false)
    private String isDeleted = "N"; // ê¸°ë³¸ê°’: ì‚­ì œë˜ì§€ ì•ŠìŒ

    @Column(name = "created_at", nullable = false, updatable = false)
    private LocalDateTime createdAt;

    @Column(name = "updated_at")
    private LocalDateTime updatedAt;

    // ì—°ê´€ê´€ê³„ ë§¤í•‘ ============================

    // í•˜ë‚˜ì˜ ë°©ì€ ì—¬ëŸ¬ëª…ì´ ìƒì„±í•  ìˆ˜ ìˆìŒ. 
    @OneToMany(mappedBy = "chatRoom", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<ChatroomUser> users = new ArrayList<>();

    // í•˜ë‚˜ì˜ ë°©ì— ì—¬ëŸ¬ê°œì˜ ì±„íŒ…ì„ í•  ìˆ˜ ìˆë‹¤.
    @OneToMany(mappedBy = "chatRoom", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<ChatMessage> messages = new ArrayList<>();

    // í•˜ë‚˜ì˜ ë°©ì— ì—¬ëŸ¬ê°œì˜ ê³µì§€ì‚¬í•­ì„ ì„¤ì • í•  ìˆ˜ ìˆë‹¤.
    @OneToMany(mappedBy = "chatRoom", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<ChatroomNoticeHistory> notices = new ArrayList<>();

    // í•˜ë‚˜ì˜ ì±„íŒ…ë°©ì— ì—¬ëŸ¬ê°œì˜ "ì¢‹ì•„ìš”"ë¥¼ ëˆ„ë¥¼ ìˆ˜ ìˆë‹¤.
    @OneToMany(mappedBy = "chatRoom", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<ChatroomLike> likes = new ArrayList<>();

    @ManyToMany
    @JoinTable(
        name = "CHATROOMHASHTAG",
        joinColumns = @JoinColumn(name = "chatroom_id"),
        inverseJoinColumns = @JoinColumn(name = "hashtag_id")
    )
    private List<Hashtag> hashtags = new ArrayList<>();

    @PrePersist
    public void prePersist() {
        this.createdAt = LocalDateTime.now();
    }

    @PreUpdate
    public void preUpdate() {
        this.updatedAt = LocalDateTime.now();
    }

    // í¸ì˜ ë©”ì„œë“œ
    public void addUser(ChatroomUser user) {
        users.add(user);
        user.setChatRoom(this);
    }

    public void addMessage(ChatMessage message) {
        messages.add(message);
        message.setChatRoom(this);
    }

    public void addNotice(ChatroomNoticeHistory notice) {
        notices.add(notice);
        notice.setChatRoom(this);
    }

    public void addHashtag(Hashtag hashtag) {
        hashtags.add(hashtag);
    }
}

```

ğŸ‘‰ ì™œ @Setterë¥¼ ì•ˆ ì¼ì„ê¹Œ?
ì´ìœ : ê°ì²´ì˜ ë¬´ë¶„ë³„í•œ ë³€ê²½ì„ ë§‰ê¸° ìœ„í•´ì„œ

âœ… ëŒ€ì‹ ì— Builder íŒ¨í„´ -> ê°ì²´ ìƒì„± ì‹œ ê°’ì„ ì„¤ì •, ì´í›„ ë³€ê²½ ë¶ˆê°€ 

âœ… ì¶”í›„ì—  enumì„ ì‚¬ìš©í•˜ì—¬ ë¦¬íŒ©í† ë§ ì˜ˆì • 
```java
  @Builder.Default
    @Column(name = "is_deleted", length = 1, nullable = false)
    private String isDeleted = "N"; // ê¸°ë³¸ê°’: ì‚­ì œë˜ì§€ ì•ŠìŒ

//DeleteStatus ê°™ì€ ìƒíƒœê°’ì„ ë¬¸ìì—´ë¡œ ì“°ì§€ ì•Šê³  íƒ€ì…ìœ¼ë¡œ í‘œí˜„
// í´ë˜ìŠ¤ íŒŒì¼ í•˜ë‚˜ ë§Œë“¤ì–´ì„œ ì •ì˜í•˜ê³ ,
ì—”í‹°í‹°ì—ì„œ @Enumerated(EnumType.STRING)ìœ¼ë¡œ ë§¤í•‘í•˜ë©´ ë!
```

ì¥ê¸°ì ìœ¼ë¡œ enumì´ ìœ ë¦¬í•œ ê²½ìš°ëŠ” ì´ëŸ° ìƒí™©:
ì½”ë“œê°€ ì»¤ì§ˆìˆ˜ë¡	ì˜¤íƒ€ ìœ„í—˜ì´ ëŠ˜ì–´ë‚¨ ("y" vs "Y")
í˜‘ì—…ì´ ë§ì•„ì§ˆìˆ˜ë¡	ì˜ë¯¸ë¥¼ ë¬¸ì„œí™”í•˜ì§€ ì•Šì•„ë„ ëª…í™•í•´ì§ (DeleteStatus.N)
ê°’ì´ ëŠ˜ì–´ë‚  ê°€ëŠ¥ì„± ìˆì„ ë•Œ	ì˜ˆ: "D" (ë¸”ë¼ì¸ë“œ), "H" (ìˆ¨ê¹€) ê°™ì€ ìƒíƒœê°€ ì¶”ê°€ë  ìˆ˜ë„ ìˆìŒ

 @PrePersist, @PreUpdate
 "DBì— INSERT/UPDATE ë˜ê¸° ì§ì „ì— ìë™ ì‹¤í–‰ë˜ëŠ” ë©”ì„œë“œ"ë¥¼ ì„¤ì •í•˜ëŠ” ê¸°ëŠ¥

 ### ì—”í‹°í‹° ë¦¬í¬ì§€í† ë¦¬
 ![image](https://github.com/user-attachments/assets/ff48de68-39f9-4e39-9056-03ccc403ba9c)



### 2025-05-18 ì±„íŒ…ë°© ì—”í‹°í‹° ì¶”ê°€

ë„ë©”ì¸ ì£¼ë„ ì„¤ê³„(DDD) ê´€ì  

âœ… ë¹„ì¦ˆë‹ˆìŠ¤ ìƒíƒœ ë³€ê²½ ë¡œì§ì€ ì—”í‹°í‹° ì•ˆì— ë„£ëŠ” ê²Œ ì¢‹ë‹¤.

```
ğŸ’¡ ì™œ ì„œë¹„ìŠ¤ê°€ ì•„ë‹ˆë¼ ì—”í‹°í‹° ì•ˆì— ë„£ì„ê¹Œ?
ì—”í‹°í‹°ì— ë‘˜ ë•Œ ì¥ì 	ì„¤ëª…
ğŸ§  ì˜ë¯¸ê°€ ëª…í™•	chatRoom.delete() â†’ ì±„íŒ…ë°©ì˜ "ì‚­ì œ"ë¼ëŠ” í–‰ìœ„ë¥¼ ì •í™•íˆ í‘œí˜„
ğŸ›¡ ê·œì¹™ ë³´í˜¸	í•„ë“œ ì§ì ‘ ìˆ˜ì • ë§‰ê³ , delete()ë¥¼ í†µí•´ì„œë§Œ ìƒíƒœ ë³€ê²½ ìœ ë„
ğŸ” ì¬ì‚¬ìš© ìš©ì´	ì–´ë””ì„œë“  ë™ì¼í•œ ë¡œì§ ì¬ì‚¬ìš©
ğŸ§± DDD ì„¤ê³„ ì² í•™	ë„ë©”ì¸ ë¡œì§ì€ ë„ë©”ì¸ ê°ì²´ê°€ ì£¼ë„í•´ì•¼ í•¨

public void delete() {
    this.isDeleted = "Y";
    this.updatedAt = LocalDateTime.now();
}

âœ¨ ê²°ë¡ 
delete() ê°™ì€ ë¹„ì¦ˆë‹ˆìŠ¤ ìƒíƒœ ë³€ê²½ ë¡œì§ì€ ì—”í‹°í‹°ì— ì •ì˜
```
