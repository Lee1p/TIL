## ğŸ“Œ ìŠ¤í”„ë§ë¶€íŠ¸ ì±„íŒ…ë°© ëª©ë¡ ì¡°íšŒ êµ¬í˜„ ì •ë¦¬ (JPA + MVC + Thymeleaf)

### íë¦„ 
Entity ìƒì„± ->  Repository ìƒì„± -> DTO ìƒì„± -> Service ìƒì„± -> Controller ìƒì„± -> View / API ì—°ë™

â¬‡ï¸ ì±„íŒ…ë°© ERD

![image](https://github.com/user-attachments/assets/75805f92-b269-43da-8e8f-31aab5b63741)


ì±„íŒ…ë°© Entity

```java
package com.test.foodtrip.domain.chat.entity;


import lombok.AccessLevel;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Getter;
import lombok.NoArgsConstructor;
import jakarta.persistence.*;
import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;

@Entity
@Table(name = "chatroom")
@Getter 
@NoArgsConstructor(access = AccessLevel.PROTECTED) // JPA ë‚´ë¶€ìš© ê¸°ë³¸ ìƒì„±ì
@AllArgsConstructor
@Builder
public class ChatRoom {

    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "chat_room_seq")
    @SequenceGenerator(name = "chat_room_seq", sequenceName = "chat_room_seq", allocationSize = 1)
    @Column(name = "chatroom_id")
    private Long id;

    @Column(name = "title", length = 100, nullable = false)
    private String title;

    @Column(name = "thumbnail_image_url", length = 255)
    private String thumbnailImageUrl;

    @Builder.Default
    @Column(name = "is_deleted", length = 1, nullable = false)
    private String isDeleted = "N"; // ê¸°ë³¸ê°’: ì‚­ì œë˜ì§€ ì•ŠìŒ

    @Column(name = "created_at", nullable = false, updatable = false)
    private LocalDateTime createdAt;

    @Column(name = "updated_at")
    private LocalDateTime updatedAt;

    // ì—°ê´€ê´€ê³„ ë§¤í•‘ ============================

    // í•˜ë‚˜ì˜ ë°©ì€ ì—¬ëŸ¬ëª…ì´ ìƒì„±í•  ìˆ˜ ìˆìŒ. 
    @OneToMany(mappedBy = "chatRoom", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<ChatroomUser> users = new ArrayList<>();

    // í•˜ë‚˜ì˜ ë°©ì— ì—¬ëŸ¬ê°œì˜ ì±„íŒ…ì„ í•  ìˆ˜ ìˆë‹¤.
    @OneToMany(mappedBy = "chatRoom", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<ChatMessage> messages = new ArrayList<>();

    // í•˜ë‚˜ì˜ ë°©ì— ì—¬ëŸ¬ê°œì˜ ê³µì§€ì‚¬í•­ì„ ì„¤ì • í•  ìˆ˜ ìˆë‹¤.
    @OneToMany(mappedBy = "chatRoom", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<ChatroomNoticeHistory> notices = new ArrayList<>();

    // í•˜ë‚˜ì˜ ì±„íŒ…ë°©ì— ì—¬ëŸ¬ê°œì˜ "ì¢‹ì•„ìš”"ë¥¼ ëˆ„ë¥¼ ìˆ˜ ìˆë‹¤.
    @OneToMany(mappedBy = "chatRoom", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<ChatroomLike> likes = new ArrayList<>();

    @ManyToMany
    @JoinTable(
        name = "CHATROOMHASHTAG",
        joinColumns = @JoinColumn(name = "chatroom_id"),
        inverseJoinColumns = @JoinColumn(name = "hashtag_id")
    )
    private List<Hashtag> hashtags = new ArrayList<>();

    @PrePersist
    public void prePersist() {
        this.createdAt = LocalDateTime.now();
    }

    @PreUpdate
    public void preUpdate() {
        this.updatedAt = LocalDateTime.now();
    }

    // í¸ì˜ ë©”ì„œë“œ
    public void addUser(ChatroomUser user) {
        users.add(user);
        user.setChatRoom(this);
    }

    public void addMessage(ChatMessage message) {
        messages.add(message);
        message.setChatRoom(this);
    }

    public void addNotice(ChatroomNoticeHistory notice) {
        notices.add(notice);
        notice.setChatRoom(this);
    }

    public void addHashtag(Hashtag hashtag) {
        hashtags.add(hashtag);
    }
}

```

ğŸ‘‰ ì™œ @Setterë¥¼ ì•ˆ ì¼ì„ê¹Œ?
ì´ìœ : ê°ì²´ì˜ ë¬´ë¶„ë³„í•œ ë³€ê²½ì„ ë§‰ê¸° ìœ„í•´ì„œ

âœ… ëŒ€ì‹ ì— Builder íŒ¨í„´ -> ê°ì²´ ìƒì„± ì‹œ ê°’ì„ ì„¤ì •, ì´í›„ ë³€ê²½ ë¶ˆê°€ 

âœ… ì¶”í›„ì—  enumì„ ì‚¬ìš©í•˜ì—¬ ë¦¬íŒ©í† ë§ ì˜ˆì • 
```java
  @Builder.Default
    @Column(name = "is_deleted", length = 1, nullable = false)
    private String isDeleted = "N"; // ê¸°ë³¸ê°’: ì‚­ì œë˜ì§€ ì•ŠìŒ

//DeleteStatus ê°™ì€ ìƒíƒœê°’ì„ ë¬¸ìì—´ë¡œ ì“°ì§€ ì•Šê³  íƒ€ì…ìœ¼ë¡œ í‘œí˜„
// í´ë˜ìŠ¤ íŒŒì¼ í•˜ë‚˜ ë§Œë“¤ì–´ì„œ ì •ì˜í•˜ê³ ,
ì—”í‹°í‹°ì—ì„œ @Enumerated(EnumType.STRING)ìœ¼ë¡œ ë§¤í•‘í•˜ë©´ ë!
```

ì¥ê¸°ì ìœ¼ë¡œ enumì´ ìœ ë¦¬í•œ ê²½ìš°ëŠ” ì´ëŸ° ìƒí™©:
ì½”ë“œê°€ ì»¤ì§ˆìˆ˜ë¡	ì˜¤íƒ€ ìœ„í—˜ì´ ëŠ˜ì–´ë‚¨ ("y" vs "Y")
í˜‘ì—…ì´ ë§ì•„ì§ˆìˆ˜ë¡	ì˜ë¯¸ë¥¼ ë¬¸ì„œí™”í•˜ì§€ ì•Šì•„ë„ ëª…í™•í•´ì§ (DeleteStatus.N)
ê°’ì´ ëŠ˜ì–´ë‚  ê°€ëŠ¥ì„± ìˆì„ ë•Œ	ì˜ˆ: "D" (ë¸”ë¼ì¸ë“œ), "H" (ìˆ¨ê¹€) ê°™ì€ ìƒíƒœê°€ ì¶”ê°€ë  ìˆ˜ë„ ìˆìŒ

 @PrePersist, @PreUpdate
 "DBì— INSERT/UPDATE ë˜ê¸° ì§ì „ì— ìë™ ì‹¤í–‰ë˜ëŠ” ë©”ì„œë“œ"ë¥¼ ì„¤ì •í•˜ëŠ” ê¸°ëŠ¥

 ### ì—”í‹°í‹° ë¦¬í¬ì§€í† ë¦¬
 ![image](https://github.com/user-attachments/assets/ff48de68-39f9-4e39-9056-03ccc403ba9c)



### 2025-05-18 ì±„íŒ…ë°© ì—”í‹°í‹° ì¶”ê°€

ë„ë©”ì¸ ì£¼ë„ ì„¤ê³„(DDD) ê´€ì  

âœ… ë¹„ì¦ˆë‹ˆìŠ¤ ìƒíƒœ ë³€ê²½ ë¡œì§ì€ ì—”í‹°í‹° ì•ˆì— ë„£ëŠ” ê²Œ ì¢‹ë‹¤.

```
ğŸ’¡ ì™œ ì„œë¹„ìŠ¤ê°€ ì•„ë‹ˆë¼ ì—”í‹°í‹° ì•ˆì— ë„£ì„ê¹Œ?
ì—”í‹°í‹°ì— ë‘˜ ë•Œ ì¥ì 	ì„¤ëª…
ğŸ§  ì˜ë¯¸ê°€ ëª…í™•	chatRoom.delete() â†’ ì±„íŒ…ë°©ì˜ "ì‚­ì œ"ë¼ëŠ” í–‰ìœ„ë¥¼ ì •í™•íˆ í‘œí˜„
ğŸ›¡ ê·œì¹™ ë³´í˜¸	í•„ë“œ ì§ì ‘ ìˆ˜ì • ë§‰ê³ , delete()ë¥¼ í†µí•´ì„œë§Œ ìƒíƒœ ë³€ê²½ ìœ ë„
ğŸ” ì¬ì‚¬ìš© ìš©ì´	ì–´ë””ì„œë“  ë™ì¼í•œ ë¡œì§ ì¬ì‚¬ìš©
ğŸ§± DDD ì„¤ê³„ ì² í•™	ë„ë©”ì¸ ë¡œì§ì€ ë„ë©”ì¸ ê°ì²´ê°€ ì£¼ë„í•´ì•¼ í•¨

public void delete() {
    this.isDeleted = "Y";
    this.updatedAt = LocalDateTime.now();
}

âœ¨ ê²°ë¡ 
delete() ê°™ì€ ë¹„ì¦ˆë‹ˆìŠ¤ ìƒíƒœ ë³€ê²½ ë¡œì§ì€ ì—”í‹°í‹°ì— ì •ì˜
```


## ChatRoomUser ì—”í‹°í‹° 

lastReadMessageId â†’ ë‹¨ìˆœ Longìœ¼ë¡œ ìœ ì§€ (FK ì•ˆ ê±¸ê¸°)

role ê¸°ë³¸ê°’ì€ "MEMBER"

status ê¸°ë³¸ê°’ì€ "JOINED" (ì±„íŒ…ë°© ì°¸ì—¬ ì§í›„ ìƒíƒœ)

JPA ê´€ì ì—ì„œ ê¸°ë³¸ê°’ì„ ì½”ë“œë¡œ ë³´ì¥ (DBì— DEFAULT ì„¤ì •ì€ ë³´ì¥ ì•ˆ ë¨)


```java
package com.test.foodtrip.domain.chat.entity;

import com.test.foodtrip.domain.user.entity.User;
import jakarta.persistence.*;
import lombok.*;

import java.time.LocalDateTime;

@Entity
@Table(name = "chatroomuser")
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@AllArgsConstructor
@Builder
public class ChatroomUser {

    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "chatroom_user_seq")
    @SequenceGenerator(name = "chatroom_user_seq", sequenceName = "chatroom_user_seq", allocationSize = 1)
    @Column(name = "chatroom_user_id")
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "chatroom_id", nullable = false)
    private ChatRoom chatRoom;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "user_id", nullable = false)
    private User user;

    @Column(name = "role", nullable = false, length = 10)
    private String role;

    @Column(name = "profile_image_url", length = 255)
    private String profileImageUrl;

    @Column(name = "joined_at", nullable = false, updatable = false)
    private LocalDateTime joinedAt;

    @Column(name = "left_at")
    private LocalDateTime leftAt;

    @Column(name = "status", length = 10, nullable = false)
    private String status;

    @Column(name = "status_updated_at")
    private LocalDateTime statusUpdatedAt;

    @Column(name = "last_read_message_id")
    private Long lastReadMessageId; // FK ì•„ë‹˜

    // ====== JPA ìƒëª…ì£¼ê¸° ======
    @PrePersist
    public void prePersist() {
        this.joinedAt = LocalDateTime.now();
        if (this.role == null) this.role = "MEMBER";
        if (this.status == null) {
            this.status = "JOINED";
            this.statusUpdatedAt = LocalDateTime.now();
        }
    }

    // ====== ë„ë©”ì¸ í–‰ìœ„ ë©”ì„œë“œ ======

    public void leave() {
        this.status = "LEFT";
        this.leftAt = LocalDateTime.now();
        this.statusUpdatedAt = LocalDateTime.now();
    }

    public void kick() {
        this.status = "KICKED";
        this.leftAt = LocalDateTime.now();
        this.statusUpdatedAt = LocalDateTime.now();
    }

    public void setChatRoom(ChatRoom chatRoom) {
        this.chatRoom = chatRoom;
    }

    public void setUser(User user) {
        this.user = user;
    }

    public void updateLastReadMessageId(Long messageId) {
        this.lastReadMessageId = messageId;
    }
}


```


âœ… ìš”ì•½ í¬ì¸íŠ¸
í•­ëª©	ì„¤ì •
role ê¸°ë³¸ê°’	"MEMBER" â†’ @PrePersistë¡œ ì½”ë“œì—ì„œ ì§€ì •
status ê¸°ë³¸ê°’	"JOINED" + ì‹œê°„ë„ ê°™ì´ ì„¤ì •
lastReadMessageId	Long íƒ€ì…ìœ¼ë¡œ FK ì—†ì´ ì‚¬ìš©
ë„ë©”ì¸ ë©”ì„œë“œ	leave(), kick(), updateLastReadMessageId()


## ChatMessage

âœ… ë°˜ì˜ëœ ì£¼ìš” ë³€ê²½ì‚¬í•­
ë³€ê²½ í•­ëª©	ì„¤ëª…
ğŸ”’ @Setter ì œê±°	ë„ë©”ì¸ ë³´í˜¸ë¥¼ ìœ„í•´ ì „ì—­ setter ì œê±°
âœ… setChatRoom(), setUser() ë“± ìˆ˜ë™ ë©”ì„œë“œ ì œê³µ	ì—°ê´€ê´€ê³„ ì£¼ì…ìš©
âœ… addReadLog(), addMention() í¸ì˜ ë©”ì„œë“œ ìœ ì§€	ì–‘ë°©í–¥ ê´€ê³„ ì •ë¦¬
ğŸ§­ latitude, longitudeì— precision ì ìš©	í•„ìš” ì‹œ ì •ë°€ë„ ì ìš©

```java
package com.test.foodtrip.domain.chat.entity;

import com.test.foodtrip.domain.user.entity.User;
import jakarta.persistence.*;
import lombok.AccessLevel;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Getter;
import lombok.NoArgsConstructor;

import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;

@Entity
@Table(name = "chatmessage") // ì±„íŒ…ë°© ë©”ì‹œì§€ í…Œì´ë¸”
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@AllArgsConstructor
@Builder
public class ChatMessage {

    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "chat_message_seq")
    @SequenceGenerator(name = "chat_message_seq", sequenceName = "chat_message_seq", allocationSize = 1)
    @Column(name = "message_id")
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "chatroom_id", nullable = false)
    private ChatRoom chatRoom;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "user_id")
    private User user;

    @Column(name = "message_type", nullable = false, length = 20)
    private String messageType = "TEXT";

    @Lob
    @Column(name = "message_content")
    private String messageContent;

    @Column(name = "file_url", length = 255)
    private String fileUrl;

    @Column(name = "file_type", length = 50)
    private String fileType;

    @Column(name = "latitude", precision = 10, scale = 6)
    private Double latitude;

    @Column(name = "longitude", precision = 10, scale = 6)
    private Double longitude;

    @Column(name = "location_description", length = 255)
    private String locationDescription;

    @Column(name = "created_at", nullable = false, updatable = false)
    private LocalDateTime createdAt;

    // ============ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ ============

    @OneToMany(mappedBy = "message", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<ChatMessageReadLog> readLogs = new ArrayList<>();

    @OneToMany(mappedBy = "message", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<ChatMessageMention> mentions = new ArrayList<>();

    // ============ ìƒëª…ì£¼ê¸° ============

    @PrePersist
    public void prePersist() {
        this.createdAt = LocalDateTime.now();
    }

    // ============ ì—°ê´€ê´€ê³„ ì„¤ì • ë©”ì„œë“œ ============

    public void setChatRoom(ChatRoom chatRoom) {
        this.chatRoom = chatRoom;
    }

    public void setUser(User user) {
        this.user = user;
    }

    // ============ í¸ì˜ ë©”ì„œë“œ ============

    public void addReadLog(ChatMessageReadLog readLog) {
        this.readLogs.add(readLog);
        readLog.setMessage(this);
    }

    public void addMention(ChatMessageMention mention) {
        this.mentions.add(mention);
        mention.setMessage(this);
    }
}

```


## ì±„íŒ…ë°© ê´€ê³„ í…Œì´ë¸” (ChatMessageReadLog,ChatMessageMention)

```java
// ChatMessageMention
package com.test.foodtrip.domain.chat.entity;

import com.test.foodtrip.domain.user.entity.User;
import jakarta.persistence.*;
import lombok.*;

import java.io.Serializable;

@Entity
@Table(name = "chatmessagemention") // ì±„íŒ…ë°© ë©˜ì…˜ ê´€ê³„ í…Œì´ë¸”
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class ChatMessageMention {

    @EmbeddedId
    private ChatMessageMentionId id;

    @MapsId("messageId")
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "message_id")
    private ChatMessage message;

    @MapsId("mentionedUserId")
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "mentioned_user_id")
    private User mentionedUser;

    public void setMessage(ChatMessage message) {
        this.message = message;
    }

    public void setMentionedUser(User user) {
        this.mentionedUser = user;
    }

    // ë³µí•©í‚¤ í´ë˜ìŠ¤
    @Embeddable
    @Getter
    @Setter
    @NoArgsConstructor(access = AccessLevel.PROTECTED)
    public static class ChatMessageMentionId implements Serializable {

        private static final long serialVersionUID = 1L;

        @Column(name = "message_id")
        private Long messageId;

        @Column(name = "mentioned_user_id")
        private Long mentionedUserId;

        public ChatMessageMentionId(Long messageId, Long mentionedUserId) {
            this.messageId = messageId;
            this.mentionedUserId = mentionedUserId;
        }

        @Override
        public boolean equals(Object o) {
            if (this == o) return true;
            if (o == null || getClass() != o.getClass()) return false;
            ChatMessageMentionId that = (ChatMessageMentionId) o;
            return messageId.equals(that.messageId) && mentionedUserId.equals(that.mentionedUserId);
        }

        @Override
        public int hashCode() {
            return 31 * messageId.hashCode() + mentionedUserId.hashCode();
        }
    }
}

``` 

âœ… ì§€ê¸ˆ êµ¬ì¡°ì˜ í•µì‹¬ ìš”ì•½
í•­ëª©	ì„¤ëª…
@EmbeddedId	ë³µí•©í‚¤ë¥¼ ë³„ë„ ì‹ë³„ì í´ë˜ìŠ¤ë¡œ ë§Œë“¤ë˜, ë‚´ë¶€ í´ë˜ìŠ¤ë¡œ í¬í•¨
@MapsId	ì™¸ë˜í‚¤ + ë³µí•©í‚¤ë¥¼ ì—°ê²° (ëª…ì‹œì  ë§¤í•‘)
equals(), hashCode()	ì‹ë³„ì ë¹„êµì™€ ì»¬ë ‰ì…˜ ê´€ë¦¬ì— í•„ìˆ˜

âœ… ì™œ equals()ì™€ hashCode()ë¥¼ ë°˜ë“œì‹œ êµ¬í˜„í•´ì•¼ í• ê¹Œ?
JPAì—ì„œ @EmbeddedIdë¥¼ ì‚¬ìš©í•  ë•ŒëŠ”
í•´ë‹¹ ê°ì²´ê°€ ì—”í‹°í‹°ì˜ "ì‹ë³„ì" ì—­í• ì„ í•˜ê¸° ë•Œë¬¸ì—
â†’ ì»¬ë ‰ì…˜(Set, Map), ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì •í™•íˆ ë¹„êµí•˜ê³  ì¶”ì í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.


```java
// chatmessagemention
package com.test.foodtrip.domain.chat.entity;


import com.test.foodtrip.domain.user.entity.User;
import lombok.AccessLevel;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import jakarta.persistence.*;

@Entity
@Table(name = "chatmessagemention") // ì±„íŒ…ë°© ë©˜ì…˜ ê´€ê³„ í…Œì´ë¸”
@Getter @Setter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class ChatMessageMention {

    @EmbeddedId
    private ChatMessageMentionId id;

    @MapsId("messageId")
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "message_id")
    private ChatMessage message;

    @MapsId("mentionedUserId")
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "mentioned_user_id")
    private User mentionedUser;

    // ë³µí•©í‚¤ í´ë˜ìŠ¤
    @Embeddable
    @Getter @Setter
    @NoArgsConstructor(access = AccessLevel.PROTECTED)
    public static class ChatMessageMentionId implements java.io.Serializable {

        private static final long serialVersionUID = 1L;

        @Column(name = "message_id")
        private Long messageId;

        @Column(name = "mentioned_user_id")
        private Long mentionedUserId;

        public ChatMessageMentionId(Long messageId, Long mentionedUserId) {
            this.messageId = messageId;
            this.mentionedUserId = mentionedUserId;
        }

        @Override
        public boolean equals(Object o) {
            if (this == o) return true;
            if (o == null || getClass() != o.getClass()) return false;

            ChatMessageMentionId that = (ChatMessageMentionId) o;

            if (!messageId.equals(that.messageId)) return false;
            return mentionedUserId.equals(that.mentionedUserId);
        }

        @Override
        public int hashCode() {
            int result = messageId.hashCode();
            result = 31 * result + mentionedUserId.hashCode();
            return result;
        }
    }
}

```

í•­ëª©	ì„¤ëª…
@EmbeddedId + ë‚´ë¶€ í´ë˜ìŠ¤ êµ¬ì„±	íŒŒì¼ í•˜ë‚˜ë¡œ ê¹”ë”í•˜ê²Œ ìº¡ìŠí™” âœ…
@MapsId	ì™¸ë˜í‚¤ + ì‹ë³„ì ì—°ê²° ëª…í™•í•˜ê²Œ âœ…
@PrePersistë¡œ readAt ìë™ ì²˜ë¦¬	ì‹¤ë¬´ ê¸°ì¤€ì— ë¶€í•© âœ…
equals/hashCode êµ¬í˜„	JPA ì‹ë³„ì ìš”êµ¬ì‚¬í•­ ì¶©ì¡± âœ…
LAZY ë¡œë”©	ì„±ëŠ¥ì ìœ¼ë¡œ ì˜¬ë°”ë¥¸ ì„¤ì • âœ…


## í•´ì‹œíƒœê·¸ ê´€ë ¨ í…Œì´ë¸”

```java

âœ… ìš”êµ¬ì‚¬í•­ ì •ë¦¬
ì¡°ê±´	ì„¤ëª…
í•˜ë‚˜ì˜ ì±„íŒ…ë°© â†’ ì—¬ëŸ¬ ê°œì˜ í•´ì‹œíƒœê·¸	âœ… 1:N
í•˜ë‚˜ì˜ í•´ì‹œíƒœê·¸ â†’ ì—¬ëŸ¬ ì±„íŒ…ë°©ì—ì„œ ì‚¬ìš© ê°€ëŠ¥	âœ… N:1
ê°™ì€ ì±„íŒ…ë°©ì— ê°™ì€ í•´ì‹œíƒœê·¸ëŠ” ì¤‘ë³µ X	âœ… UNIQUE(chatroom_id, hashtag_id)ë¡œ ì œì•½ ê±¸ê¸°
ë‹¤ë¥¸ ì±„íŒ…ë°©ë¼ë¦¬ëŠ” ê°™ì€ í•´ì‹œíƒœê·¸ ê°€ëŠ¥	âœ… ë¬¸ì œ ì—†ìŒ


package com.test.foodtrip.domain.chat.entity;

import jakarta.persistence.*;
import lombok.*;

import java.util.ArrayList;
import java.util.List;

@Entity
@Table(name = "HASHTAG")
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@AllArgsConstructor
@Builder
public class Hashtag {

    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "hashtag_seq")
    @SequenceGenerator(name = "hashtag_seq", sequenceName = "hashtag_seq", allocationSize = 1)
    @Column(name = "hashtag_id")
    private Long id;

    @Column(name = "tag_text", length = 30, nullable = false, unique = true)
    private String tagText;

    // ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ (ì„ íƒì‚¬í•­)
    @OneToMany(mappedBy = "hashtag", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<ChatRoomHashtag> chatRoomHashtags = new ArrayList<>();

    // í¸ì˜ ë©”ì„œë“œ (ì„ íƒ)
    public void addChatRoomHashtag(ChatRoomHashtag mapping) {
        chatRoomHashtags.add(mapping);
        mapping.setHashtag(this);
    }
}

```

```java
package com.test.foodtrip.domain.chat.entity;

import jakarta.persistence.*;
import lombok.*;

@Entity
@Table(name = "CHATROOMHASHTAG",
       uniqueConstraints = @UniqueConstraint(columnNames = {"chatroom_id", "hashtag_id"}))
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@AllArgsConstructor
@Builder
public class ChatRoomHashtag {

    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "chatroom_hashtag_seq")
    @SequenceGenerator(name = "chatroom_hashtag_seq", sequenceName = "chatroom_hashtag_seq", allocationSize = 1)
    @Column(name = "id")
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "chatroom_id", nullable = false)
    private ChatRoom chatRoom;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "hashtag_id", nullable = false)
    private Hashtag hashtag;

    public void setChatRoom(ChatRoom chatRoom) {
        this.chatRoom = chatRoom;
    }

    public void setHashtag(Hashtag hashtag) {
        this.hashtag = hashtag;
    }
}

âœ… ì£¼ì˜ ì‚¬í•­
í•­ëª©	ì´ìœ 
@ManyToMany ì‚¬ìš©í•˜ì§€ ì•Šì€ ì´ìœ 	ì¡°ì¸ í…Œì´ë¸”ì„ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•˜ê³  ì œì•½ ì¡°ê±´ ë„£ê¸° ìœ„í•¨
UNIQUE ì œì•½	ë™ì¼ ì±„íŒ…ë°©ì—ì„œ ì¤‘ë³µ í•´ì‹œíƒœê·¸ ê¸ˆì§€ ì¡°ê±´ ë°˜ì˜
@SequenceGenerator	Oracle í™˜ê²½ ê¸°ì¤€ì— ë§ì¶° ìƒì„± ë°©ì‹ ì„¤ì •
```

## ì±„íŒ…ë°© ì¢‹ì•„ìš” í…Œì´ë¸”


```java
âœ… ìš”êµ¬ì‚¬í•­ ì •ë¦¬
ì¡°ê±´	ì„¤ëª…
í•˜ë‚˜ì˜ ì±„íŒ…ë°©ì— ì—¬ëŸ¬ ëª…ì´ ì¢‹ì•„ìš” ê°€ëŠ¥	âœ… Many to One (to ChatRoom)
í•œ ëª…ì˜ ìœ ì €ëŠ” ê°™ì€ ì±„íŒ…ë°©ì— 1ë²ˆë§Œ ê°€ëŠ¥	âœ… UNIQUE(chatroom_id, user_id) ì œì•½
ë‹¤ì‹œ ì·¨ì†Œí•˜ë©´ ìƒíƒœë§Œ ë°”ê¿ˆ (Y, N)	âœ… is_active ì»¬ëŸ¼ìœ¼ë¡œ soft toggle
ì¸ê¸° ìˆœ ì •ë ¬ì„ ìœ„í•¨	âœ… is_active = 'Y' ì¹´ìš´íŠ¸ ê¸°ì¤€



